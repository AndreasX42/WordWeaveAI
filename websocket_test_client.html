<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WordWeave - Real-time Vocab Processing</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        background: white;
        border-radius: 10px;
        padding: 30px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
        text-align: center;
        margin-bottom: 30px;
      }
      .connection-status {
        padding: 10px;
        border-radius: 5px;
        margin-bottom: 20px;
        text-align: center;
        font-weight: bold;
      }
      .connected {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .disconnected {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .controls {
        display: grid;
        grid-template-columns: 1fr auto auto;
        gap: 10px;
        margin-bottom: 20px;
        align-items: end;
      }
      .form-group {
        display: flex;
        flex-direction: column;
      }
      label {
        margin-bottom: 5px;
        font-weight: bold;
        color: #555;
      }
      input,
      select,
      button {
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 14px;
      }
      input:focus,
      select:focus {
        outline: none;
        border-color: #007bff;
        box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
      }
      button {
        background-color: #007bff;
        color: white;
        border: none;
        cursor: pointer;
        transition: background-color 0.2s;
      }
      button:hover:not(:disabled) {
        background-color: #0056b3;
      }
      button:disabled {
        background-color: #6c757d;
        cursor: not-allowed;
      }
      .messages {
        border: 1px solid #ddd;
        border-radius: 5px;
        height: 400px;
        overflow-y: auto;
        padding: 15px;
        background-color: #fafafa;
        font-family: "Courier New", monospace;
        font-size: 12px;
      }
      .message {
        margin-bottom: 10px;
        padding: 8px;
        border-radius: 4px;
        border-left: 4px solid #007bff;
      }
      .message.processing_started {
        background-color: #e3f2fd;
        border-left-color: #2196f3;
      }
      .message.chunk_update {
        background-color: #f3e5f5;
        border-left-color: #9c27b0;
      }
      .message.processing_completed {
        background-color: #e8f5e8;
        border-left-color: #4caf50;
      }
      .message.processing_failed {
        background-color: #ffebee;
        border-left-color: #f44336;
      }
      .message.cache_hit {
        background-color: #fff8e1;
        border-left-color: #ff9800;
      }
      .timestamp {
        color: #666;
        font-size: 10px;
      }
      .progress-bar {
        width: 100%;
        height: 20px;
        background-color: #e0e0e0;
        border-radius: 10px;
        overflow: hidden;
        margin-bottom: 20px;
      }
      .progress-fill {
        height: 100%;
        background-color: #007bff;
        transition: width 0.3s ease;
        width: 0%;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üåê WordWeave - Real-time Vocab Processing</h1>

      <div id="connectionStatus" class="connection-status disconnected">
        Disconnected
      </div>

      <div class="controls">
        <div class="form-group">
          <label for="websocketUrl">WebSocket URL:</label>
          <input
            type="text"
            id="websocketUrl"
            placeholder="wss://your-api-id.execute-api.region.amazonaws.com/prod"
            value=""
          />
        </div>
        <div class="form-group">
          <label for="userId">User ID:</label>
          <input
            type="text"
            id="userId"
            placeholder="test-user"
            value="test-user"
          />
        </div>
        <button id="connectBtn" onclick="toggleConnection()">Connect</button>
      </div>

      <div class="progress-bar">
        <div id="progressFill" class="progress-fill"></div>
      </div>

      <div class="controls">
        <div class="form-group">
          <label for="sourceWord">Source Word:</label>
          <input
            type="text"
            id="sourceWord"
            placeholder="Feuer"
            value="Feuer"
          />
        </div>
        <div class="form-group">
          <label for="targetLanguage">Target Language:</label>
          <select id="targetLanguage">
            <option value="en">English</option>
            <option value="es" selected>Spanish</option>
            <option value="de">German</option>
          </select>
        </div>
        <button id="processBtn" onclick="processWord()" disabled>
          Process Word
        </button>
      </div>

      <h3>Real-time Updates:</h3>
      <div id="messages" class="messages">
        <div class="message">
          <div class="timestamp">Waiting for connection...</div>
          <div>
            Connect to start receiving real-time vocab processing updates.
          </div>
        </div>
      </div>
    </div>

    <script>
      let socket = null;
      let isConnected = false;
      let progressSteps = 0;
      let totalSteps = 10;

      function updateConnectionStatus(connected) {
        const statusDiv = document.getElementById("connectionStatus");
        const connectBtn = document.getElementById("connectBtn");
        const processBtn = document.getElementById("processBtn");

        isConnected = connected;

        if (connected) {
          statusDiv.textContent = "Connected";
          statusDiv.className = "connection-status connected";
          connectBtn.textContent = "Disconnect";
          processBtn.disabled = false;
        } else {
          statusDiv.textContent = "Disconnected";
          statusDiv.className = "connection-status disconnected";
          connectBtn.textContent = "Connect";
          processBtn.disabled = true;
          updateProgress(0);
        }
      }

      function updateProgress(percentage) {
        const progressFill = document.getElementById("progressFill");
        progressFill.style.width = `${percentage}%`;
      }

      function addMessage(type, data, timestamp) {
        const messagesDiv = document.getElementById("messages");
        const messageDiv = document.createElement("div");
        messageDiv.className = `message ${type}`;

        const timestampDiv = document.createElement("div");
        timestampDiv.className = "timestamp";
        timestampDiv.textContent = new Date(timestamp).toLocaleTimeString();

        const contentDiv = document.createElement("div");
        contentDiv.textContent = JSON.stringify(data, null, 2);

        messageDiv.appendChild(timestampDiv);
        messageDiv.appendChild(contentDiv);
        messagesDiv.appendChild(messageDiv);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;

        if (type === "processing_started") {
          progressSteps = 0;
          updateProgress(5);
        } else if (type === "chunk_update") {
          progressSteps = Math.min(progressSteps + 1, totalSteps - 1);
          updateProgress((progressSteps / totalSteps) * 90 + 5);
        } else if (type === "processing_completed") {
          updateProgress(100);
        } else if (type === "cache_hit") {
          updateProgress(100);
        }
      }

      function toggleConnection() {
        if (isConnected) {
          disconnect();
        } else {
          connect();
        }
      }

      function connect() {
        const url = document.getElementById("websocketUrl").value;
        const userId = document.getElementById("userId").value;

        if (!url) {
          alert("Please enter a WebSocket URL");
          return;
        }

        const wsUrl = `${url}?user_id=${encodeURIComponent(userId)}`;

        try {
          socket = new WebSocket(wsUrl);

          socket.onopen = function (event) {
            console.log("WebSocket connected");
            updateConnectionStatus(true);
            addMessage(
              "connection",
              { status: "connected" },
              new Date().toISOString()
            );
          };

          socket.onmessage = function (event) {
            try {
              const message = JSON.parse(event.data);
              console.log("Received message:", message);
              addMessage(message.type, message.data, message.timestamp);
            } catch (e) {
              console.error("Error parsing message:", e);
              addMessage(
                "error",
                { error: "Failed to parse message", raw: event.data },
                new Date().toISOString()
              );
            }
          };

          socket.onclose = function (event) {
            console.log("WebSocket disconnected");
            updateConnectionStatus(false);
            addMessage(
              "connection",
              {
                status: "disconnected",
                code: event.code,
                reason: event.reason,
              },
              new Date().toISOString()
            );
          };

          socket.onerror = function (error) {
            console.error("WebSocket error:", error);
            addMessage(
              "error",
              { error: "WebSocket connection error" },
              new Date().toISOString()
            );
          };
        } catch (e) {
          console.error("Failed to create WebSocket:", e);
          alert("Failed to connect: " + e.message);
        }
      }

      function disconnect() {
        if (socket) {
          socket.close();
          socket = null;
        }
      }

      function processWord() {
        if (!isConnected) {
          alert("Please connect to WebSocket first");
          return;
        }

        const sourceWord = document.getElementById("sourceWord").value;
        const targetLanguage = document.getElementById("targetLanguage").value;

        if (!sourceWord) {
          alert("Please enter a source word");
          return;
        }

        addMessage(
          "request_sent",
          {
            source_word: sourceWord,
            target_language: targetLanguage,
            note: "Send this to your backend API to trigger SQS processing",
          },
          new Date().toISOString()
        );
      }

      document
        .getElementById("sourceWord")
        .addEventListener("keypress", function (e) {
          if (e.key === "Enter" && !e.target.disabled) {
            processWord();
          }
        });

      window.addEventListener("load", function () {
        document.getElementById("messages").innerHTML =
          '<div class="message"><div class="timestamp">Ready</div><div>Enter WebSocket URL and connect to start receiving real-time updates.</div></div>';
      });
    </script>
  </body>
</html>
